profile_paths= []
new File('jenkins_shared_workspace/kx.as.code/profiles/').eachDirMatch( ~/.*vagrant.*/ ) {profile_paths<< it.path }

String underlyingOS
println profile_paths

def OS = System.getProperty("os.name", "generic").toLowerCase(Locale.ENGLISH);
if ((OS.indexOf("mac") >= 0) || (OS.indexOf("darwin") >= 0)) {
    underlyingOS = "darwin"
} else if (OS.indexOf("win") >= 0) {
    underlyingOS = "windows"
    profile_paths.removeAll { it.toLowerCase().endsWith('parallels') }
} else if (OS.indexOf("nux") >= 0) {
    underlyingOS = "linux"
} else {
    underlyingOS = "other"
}

profile_paths.sort()
profile_paths = profile_paths.join(",")
profile_paths = profile_paths.replaceAll("\\\\", "/")

return """
<head>
    <script>

        function populate_profile_option_list() {
            var profiles = "${profile_paths}".split(',');
            for ( var i = 0; i < profiles.length; i++ ) {
                var profileName = profiles[i].split("/").pop();
                profileName = profileName.replace("vagrant-", "");
                console.log("Adding profile to options: " + profileName + i);
                document.getElementById("profiles").options[i] = new Option(profileName, profileName);
                update_selected_value();
            }
        }

        function update_selected_value() {
            var selectedOptionNumber = document.getElementById("profiles").selectedIndex;
            var profilePaths = "${profile_paths}".split(',');
            var profilePath = profilePaths[selectedOptionNumber] + '/profile-config.json'
            console.log("profileName: " + profilePath)
            document.getElementById("selected-profile-path").value = profilePath;
            document.getElementById("selected-profile-path").setAttribute("selected-profile-path", profilePath) ;
            var parentId = document.getElementById("selected-profile-path").parentNode.id;
            console.log(parentId);
            jQuery('#' + parentId).trigger('change');
        }

    </script>
    <style>

        .capitalize {
            text-transform: capitalize;
        }

        .profiles-select {
            -moz-appearance: none;
            -webkit-appearance: none;
            appearance: none;
            padding-left: 10px;
            border: none;
            width: 200px;
            height: 40px;
            border-top-right-radius: 5px;
            border-bottom-right-radius: 5px;
            background-image: url("/userContent/icons/chevron-down.svg");
            background-repeat: no-repeat;
            background-position: right;
            background-color: #efefef;
            outline: none;
            border: none;
            box-shadow: none;
        }

        select {
            height: 20px;
            -webkit-border-radius: 0;
            border: 0;
            outline: 1px solid #ccc;
            outline-offset: -1px;
        }

        .profiles-select select {
            outline: none;
            border: none;
            box-shadow: none;
        }

        .profiles-select:focus {
            outline: none;
            border: none;
            box-shadow: none;
        }

    </style>
</head>
<body>
<br>
<h2>Profiles</h2>
<label for="profiles" class="input-box-label">Profiles</label><select id="profiles" class="profiles-select capitalize" onchange="update_selected_value();"></select></label>
<input type="hidden" id="selected-profile-path" name="value" value="">
<style scoped="scoped" onload="populate_profile_option_list();">   </style>
</body>
"""
